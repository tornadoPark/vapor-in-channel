## Governing equations

### 动力学方程

根据文献可知，被生长的气泡所推动的在通道内流动的液相满足如下动力学方程[^SunChao2009][^BaoBo2017]：
$$
\frac{\mu _l l'(t)}{K}+\rho _l l''(t)
=
\frac{p(t)-2\sigma/r-p_0}{l_{\text{tot}}-l(t)}
$$

对于圆管，渗透率$K=r^2/8$，其他结构（多孔介质）或者形状以此为scale无量纲化即可 

方管的渗透率可以参考文献[^Hudson2010]

对于不同的深宽比的通道，渗透率K为[^Rapp2017]：
$$
1/(\frac{12}{h^2}(1-\frac{192 h}{\pi ^5 w}\sum _{n=0}^{\infty} \frac{\tanh \left(\frac{\pi  (2 n+1) w}{2 h}\right)}{(2 n+1)^5})^{-1})
$$


| w/h  | K ($m^2$)              |
| ---- | ---------------------- |
| 8:1  | $0.0767683 \times h^2$ |
| 6:1  | $0.0745799\times h^2$ |
| 4:1  | $0.0702032\times h^2$  |
| 3:1  | $0.0658265\times h^2$ |
| 2:1  | $0.0570731\times h^2$ |
| 1:1  | $0.030813\times h^2$ |



[^SunChao2009]: Growth and collapse of a vapour bubble in a microtube: the role of thermal effects
[^BaoBo2017]: Bubble nucleation and growth in nanochannels

### 状态方程

$$
p(t) l'(t)+l(t) p'(t)
=
\frac{m'(t) \left(R_g T(t)\right)}{A}+\frac{T'(t) \left(R_g m(t)\right)}{A}
$$

其中A为单通道底部面积。对于100um深400um宽的通道而言是$4\times10^{-8}m^2$

+ 实际计算中为了和实验结果对比，应该使用实验样品的参数。

  如果忽略气体的横向入侵，那么所有气体的高度就是其体积与通道部分的底部面积之比，所以计算中只考虑通道部分的底部面积，而不是整个底部面积，因此# 200 - # 800 的面积分别是：

  + sample 200：

  $$
  A=A_{base}\times\frac{w_{throat}}{w_{width}+w_{pillar}}=7200\times100\times\frac{200}{200+400}=2.40\times10^{-7}m^2\\
  A=A_{base}\times\frac{w_{throat}}{w_{width}+w_{pillar}}=7200\times100\times\frac{400}{400+400}=3.60\times10^{-7}m^2\\
  A=A_{base}\times\frac{w_{throat}}{w_{width}+w_{pillar}}=7200\times100\times\frac{600}{600+400}=4.32\times10^{-7}m^2\\
  A=A_{base}\times\frac{w_{throat}}{w_{width}+w_{pillar}}=7200\times100\times\frac{800}{800+400}=4.80\times10^{-7}m^2\\
  $$
  
  

### 饱和线方程

假设气体是按照饱和线膨胀的，即气泡膨胀过程中，气泡内的压力和温度始终维持在饱和线上。这样知道气体压力即可获知温度和气体密度（进而获知气体质量），所以：
$$
T(t)= -173.37 p(t)^2+233.49 p(t)+352.31\\
\rho (t)= 5.1711 p(t)+0.0873
$$
### 气体质量导数

由于气体温度与压力相互确定，那么随着气体膨胀压力降低，温度也在逐渐降低。跨过液膜的传热表示为：
$$
m'(t) =m'_{eavp}(t) - m'_{vent}(t)\\
m'_{evap}(t)=\int_0^{l_{tot}}C\rho_l\frac{\partial \delta(x,t)}{\partial t}\mathrm{d}x\\
m'_{vent}(t)
=
\frac{\rho_g}{\mu_g} \frac{A_h K_h}{l_h}(p(t)-2\sigma/R_B - p_0-\rho_lgl_{tot})
$$

其中$C$是通道截面周长。这里只考虑周长中能够存在液膜并且液膜可以蒸发的那部分，因此玻璃表面那段的长度被忽略。同样考虑整个多孔介质样品的所有通道，# 200 - # 800的C分别是：

$$
C =12\times(2\times100+200)=4.8\times10^{-3}m\\
C =9\times(2\times100+400)=5.4\times10^{-3}m\\
C =7\times(2\times100+200)=5.6\times10^{-3}m\\
C =6\times(2\times100+200)=6\times10^{-3}m
$$
在具体计算中，积分被写成求和（数值积分）：
$$
m'_{evap}(t)=\sum_{x=0}^{x=l_{tot}}C\rho_l\frac{\partial \delta(x,t)}{\partial t}\Delta x
$$


### 液膜方程

液膜随着气液界面的经过而生成，$\delta_0$是液膜的初始值[^Bretherton1961]：
$$
\frac{\delta_0}{D}=0.67 Ca ^{2/3}=0.67 (\frac{\mu_l u_0}{\sigma})^{2/3}
$$
其中初始速度$u_0$是由最初两个时间步之间气泡长度的变化量计算得到。根据上式可以计算得到不同气泡生长速度生成的液膜厚度：

对于实验中的宽度为$400 um$的通道而言，不同速度对应的液膜厚度为：

| 速度m/s | 0.01      | 0.1      | 1        | 10      | 100       |
| ------- | --------- | -------- | -------- | ------- | --------- |
| $\zeta$ | 0.0000449 | 0.000208 | 0.000967 | 0.00449 | 0.0208258 |

对于$160 um$的水力直径而言，不同速度对应的液膜厚度为：
| 速度m/s | 0.01      | 0.1       | 1        | 10         | 100     |
| ------- | --------- | --------- | -------- | ---------- | ------- |
| $\zeta$ | 0.0000179 | 0.0000833 | 0.000387 | 0.00179472 | 0.00833 |

以上速度对应的毛细数为：
| 速度m/s | 0.01      | 0.1       | 1        | 10         | 100     |
| ------- | --------- | --------- | -------- | ---------- | ------- |
| $Ca$ | $4.19\times10^{-5}$ | $4.19\times10^{-4}$ | $4.19\times10^{-3}$ | $4.19\times10^{-2}$ | $4.19\times10^{-1}$ |



对于已经存在的液膜，其厚度从初始值开始逐渐降低，降低速率与局部传热速率有关。假定传热可用跨过液膜的导热近似，则：
$$
\frac{\partial \delta(x,t)}{\partial t}=\frac{\lambda _l (\theta_w(x,t) - \theta (t))}{h_{\text{fg}}\rho_l \delta (t)}
$$

其中$\theta$是气相的过余温度，定义为$\theta=T-T_{sat}$；其中$\theta_w$是固体壁面的过余温度，定义为$\theta_w=T_w-T_{sat}$。

实际计算中，每个时间步中新生成的液膜与之前已存在的液膜之间的连线需要确定。计算这段连线的斜率可知：

假设某时刻$t$液膜起点位置为$x$，$t+\Delta t$时刻液膜位置为$u\Delta t$，且此时液膜厚度为$\delta_0$，那么$t$时刻液膜厚度为$\delta_0-\frac{\partial \delta}{\partial t}\Delta t$，假设局部壁面温度相同，气液界面速度不变，那么此处斜率近似为：
$$
\frac{\partial\delta}{\partial x}=\frac{\partial \delta}{\partial t}/u\sim \frac{\theta_w-\theta}{\delta}\frac{\lambda}{u\rho h_{fg}}\sim\frac{1}{\delta}
$$
对上式积分有：$\delta\sim\sqrt{2x}$*竟然是抛物线*



### 导热方程

+ 导热方程：

在多孔介质的固体基质内存在导热，热量从底部进入多孔介质的固体基质（骨架）内，在向上导热的同时，横向将热量穿过液膜，通过蒸发的形式传如气液两相流体中。因此为了明确固体骨架内的温度分布，必须求解这一过程的传热方程。将蒸发传热看作热源，则这一过程简化为一维导热，即：
$$
\rho_sc_s\frac{\partial \theta_w(x,t)}{\partial t}=k_s\frac{\partial^2 \theta_w(x,t)}{\partial x^2}-k_l\frac{\theta_w(x,t)-\theta(t)
}{\delta(x,t)}\frac{C_{heat}}{A_{heat}}
$$
其中$C_{heat}$和$A_{heat}$分别是加热面的长度和硅截面面积。$\delta$是液膜厚度，对于有液膜的位置，其取值为有限制，液膜蒸干区域和气泡尚未生长到的位置，取值为无穷大（即绝热）

---
[^Hudson2010]: Poiseuille flow and drop circulation in microchannels
[^Rapp2017]: Chapter 17 - Hydraulic Resistance, 表17.1，出自专著：Microfluidics: Modelling, Mechanics and Mathematics

+ 导热方程的初始条件：

  假定多孔介质（单通道）是一个肋片，底部加热，顶部深入bulk water中。这样的肋片中温度的解析解是：
  $$
  (t_{fin}-t_\infty)=(t_{fin,base}-t_\infty)
  \cosh\left(\sqrt\frac{h\cdot C_{heat}}{k_s\cdot A_{heat}}(x-l_{tot})\right)
  \cdot
  \text{sech} \left(\sqrt\frac{h\cdot C_{heat}}{k_s\cdot A_{heat}}l_{tot}\right)
  $$

  +  $h$是肋片表面传热的导热系数，显然我们是没办法确定的

    + 正常来讲应该用实验测量的温度点数据，但是没有被这几个点写进文章里

    + 另一个办法是通过实验测量的传热系数来给定，似乎也有一定合理性。

  + Cheat和Aheat分别是参与肋片换热的固体的长度和截面积，因此$C_{heat}=C$。# 200 - # 800的加热面积分别有：
    $$
    A_{heat}=12\times(500\times(400+200)-200\times100)=3.36\times10^{-6}m^2\\
    A_{heat}=9\times(500\times(400+400)-400\times100)=3.24\times10^{-6}m^2\\
    A_{heat}=7\times(500\times(400+600)-600\times100)=3.08\times10^{-6}m^2\\
    A_{heat}=6\times(500\times(400+800)-800\times100)=3.12\times10^{-6}m^2
    $$
    
  

## Non-dimensional governing equations

选取如下scale：
$$
l\sim l_{tot},t\sim \frac{l_{tot}}{\sqrt{R_g T_{sat}}},p\sim\frac{\sigma}{\epsilon l_{tot}},\\
\theta\sim 5\text K,\theta_w\sim 5\text K,m\sim A l_{tot}\rho_l
$$
（为了跟之前版本程序保持，温度scale暂时人为给定5K，后续应改成饱和温度）

对上述动力学方程、状态方程和液膜厚度方程进行无量纲化，得到：
$$
Ca \frac{\mathrm{d}\bar l}{\mathrm{d}\bar t}+We\frac{\mathrm{d}^2\bar l}{\mathrm{d}\bar t^2}=\frac{\bar p-2}{1-\bar l}
$$


$$
\bar p\frac{\mathrm{d}\bar l}{\mathrm{d} \bar t}+\bar l\frac{\mathrm{d}\bar p}{\mathrm{d}\bar t}
=
We\frac{\mathrm{d}\bar m}{\mathrm{d}\bar t}
+
\iota We(\bar\theta\frac{\mathrm{d}\bar m}{\mathrm{d}\bar t}+\bar m\frac{\mathrm{d}\bar \theta}{\mathrm{d}\bar t})
$$

$$
\frac{\partial\bar\delta}{\partial\bar t}=
 - \frac{Ja}{PrRe}\times\frac{\bar\theta_w-\bar \theta}{\bar \delta}
$$

$$
\frac{\mathrm{d}\bar m}{\mathrm{d}\bar t}
= - \sum Ar\times \frac{\partial\bar\delta}{\partial\bar t}
- PGr\times\bar\rho_g(\xi\bar p-2\epsilon)
$$

$$
\frac{\partial\bar{\theta}_w}{\partial \bar t}
=
Pe_s\frac{\partial^2\bar{\theta}_w}{\partial \bar x^2}
-
Pe_l\frac{\bar\theta_w-\bar\theta}{\bar\delta}
$$

where
$$
We=\frac{\epsilon l_{tot}\rho_l R_gT_{sat}}{\sigma},
Ca=\frac{\epsilon\mu_l l_{tot}^2\sqrt{R_gT_{sat}}}{K\sigma},\\
\frac{Ja}{PrRe}=\frac{c_p\theta_{scale}}{h_{fg}}\times\frac{\lambda_l}{c_p\rho_l \nu}\times\frac{\nu}{\zeta^2l_{tot}\sqrt{R_g T_{sat}}}\\
Pe_s=\frac{k_s}{\rho_sc_sl_{tot}\sqrt{R_gT_{sat}}}, Pe_l=\frac{k_l C_{heat}}{\rho_sc_s\zeta\sqrt{R_gT_{sat}}A_{heat}}
$$

$$
\Theta=T-T_{sat},\\
\epsilon={r_{curv}}/{l_{tot}},\\
\zeta={\delta_0}/{l_{tot}},\\
\xi={R_B}/{l_{tot}},\\
\iota=\theta_{scale}/{T_{sat}},\\

Ar=\frac{\zeta C\Delta x}{A}\\
PGr=\frac{A_h}{A}\frac{\sigma}{l_hl_{tot}}\frac{K_h}{\mu_g\sqrt{R_gT_{sat}}}\frac{1}{\xi\epsilon}
$$

其中，Ja和Pr分别表征显热与潜热、热扩散和动量扩散的比值，由于潜热在传热中占据主导地位，因此其与热扩散的比值接近1，所以Ja和Pr的比值可以看作显热和动量扩散之比

Ar为面积比（area ratio），表示侧壁面积（蒸发面积）与底部面积（气泡生长基底）之比

PGr为压力梯度比（pressure gradient ratio），表示毛细压力折算到横向通道长度的压力梯度与横向流动的压力梯度之比

其中$r_{curv}$是通道的曲率半径
$$
r=1/(\frac{2}{w}+\frac{2}{h})=1/(2/100+2/400)=40 \mu m
$$


[^Bretherton1961]: The motion of long bubbles in tubes，只能找经典文献了，后来的都太复杂了……



## Discretization

### 动力学方程、状态方程、质量方程

动力学方程、状态方程，质量传输方程使用有限差分离散

### 蒸发方程

蒸发方程未确定

### 传热方程

传热方程使用有限体积法离散：

+ 内部节点

$$
\int_t^{t+\Delta t}\int_{CV}
\frac{\partial\bar\theta_{w}}{\partial \bar t}
d\bar Vd\bar t
=
(\bar\theta_w-\bar\theta_{w,P}^0)\bar A\Delta \bar x
$$

$$
\int_t^{t+\Delta t}\int_{CV}
Pe_s\frac{\partial^2\bar{\theta}_w}{\partial \bar x^2}
d\bar Vd\bar t
=
\frac{Pe_s\bar A\Delta \bar t}{\Delta \bar x}
(\bar\theta_{w,E}-2\bar\theta_{w,P}+\bar\theta_{w,W})
$$

$$
\int_t^{t+\Delta t}\int_{CV}
Pe_l\frac{\bar\theta_w-\bar\theta}{\bar\delta}
d\bar Vd\bar t
=
Pe_l\bar A\Delta \bar x\Delta \bar t
\frac{\bar\theta_{w,P}-\bar\theta}{\bar\delta}
$$

因此有：
$$
\bar\theta_{w,P}-\bar\theta_{w,P}^0
=
\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t
(\bar\theta_{w,E}-2\bar\theta_{w,P}+\bar\theta_{w,W})
-
Pe_l\Delta \bar t 
\frac{\bar\theta_{w,P}-\bar\theta}{\bar\delta}
$$
所以各项系数为（注意源项向量被移项到左侧，系数在右侧）：
$$
a_W=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
a_P=-1-2\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t-Pe_l\Delta \bar t\frac{1}{\bar \delta}\\
a_E=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
b=-\bar\theta_{w,P}^0-Pe_l\Delta \bar t \frac{\bar \theta}{\bar \delta}
$$

+ 边界条件：

  多孔介质底部为电加热，应为恒定热流密度边界条件
  $$
  \theta_{w,P}-\theta_{w,P}^0
  =
  \frac{q\Delta\bar t/\Delta\bar x}
  {\rho_s c_s\theta_{scale}\sqrt{R_gT_{sat}}}
  +
  \frac{Pe_s\Delta\bar t}{{\Delta\bar x^2}}
  ({\bar \theta_{w,E}-\bar \theta_{w,P}})
  -
  Pe_l\Delta\bar t
  \frac{\bar\theta_{w,P}-\bar\theta}{\bar\delta}
  $$
  因此各项系数为（注意源项向量被移项到左侧，系数在右侧）：
  $$
  a_1=
  -1
  -
  \frac{Pe_s}{\Delta \bar x^2}\Delta \bar t
  -
  Pe_l\Delta \bar t\frac{1}{\bar \delta}\\
  
  a_2=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
  
  b=-\bar\theta_{w,P}^0
  -
  Pe_l\Delta \bar t \frac{\bar \theta}{\bar \delta}
  -
  \frac{q\Delta\bar t/\Delta\bar x}
  {\rho_s c_s\theta_{scale}\sqrt{R_gT_{sat}}}
  $$
  
  *为了验证算法，此处写一个一类边界条件的形式：*
  $$
  \theta_{w,P}-\theta_{w,P}^0
  =
  \frac{Pe_s\Delta\bar t}{2\Delta\bar x^2}(\bar\theta_{w,Wbound}-\bar\theta_{w,P})
  +
  \frac{Pe_s\Delta\bar t}{{\Delta\bar x^2}}
  ({\bar \theta_{w,E}-\bar \theta_{w,P}})
  -
  Pe_l\Delta\bar t
  \frac{\bar\theta_{w,P}-\bar\theta}{\bar\delta}
  $$
  则系数应为：
  $$
  a_1=
  -1
  -
  \frac{3Pe_s}{2\Delta \bar x^2}\Delta \bar t
  -
  Pe_l\Delta \bar t\frac{1}{\bar \delta}\\
  
  a_2=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
  
  b=-\bar\theta_{w,P}^0
  -
  Pe_l\Delta \bar t \frac{\bar \theta}{\bar \delta}
  -
  \frac{Pe_s\Delta\bar t}{2\Delta\bar x^2}\bar\theta_{w,WBound}
  $$
  
  
  
  
  
  
  
  
  多孔介质较长，热量主要在中下部传给两相区，上方传热可忽略，因此顶部应为绝热边界条件
  $$
  \theta_{w,P}-\theta_{w,P}^0
  =
  \frac{Pe_s\Delta\bar t}{{\Delta\bar x^2}}
  ({\bar \theta_{w,W}-\bar \theta_{w,P}})
  $$
  因此各项系数为（注意源项向量被移项到左侧，系数在右侧）：
  $$
  a_{end-1}=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
  a_{end}=-1-\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
  b=-\bar\theta_{w,P}^0
  $$

考虑多孔介质末端温度固定为水温，则为第一类边界条件，离散得到：
$$
\theta_{w,P}-\theta_{w,P}^0
=
\frac{2Pe_s\Delta\bar t}{\Delta\bar x^2}(\bar\theta_{w,Ebound}-\bar\theta_{w,P})
+
\frac{Pe_s\Delta\bar t}{{\Delta\bar x^2}}
({\bar \theta_{w,W}-\bar \theta_{w,P}})
-
Pe_l\Delta\bar t
\frac{\bar\theta_{w,P}-\bar\theta}{\bar\delta}
$$
则各项系数为：
$$
a_{end-1}=\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\\
a_{end}=-1-3\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t -Pe_l\Delta \bar t\frac{1}{\bar \delta}\\
b=
-
\bar\theta_{w,P}^0 
-
2\frac{Pe_s}{\Delta \bar x^2}\Delta \bar t\times\bar\theta_{w,Ebound}
-

Pe_l\Delta \bar t \frac{\bar \theta}{\bar \delta}
$$



## 计算流程



## 模型验证

模型计算的气相区域高度 和 实验测量的气相区域面积的关系：

两者满足体积相同的条件，根据是：不考虑密度变化的情况下，相同的热流密度应该产生相同质量的气体，也就是相同体积的气体。在实验中，观察到的气体体积$S_v\times h_{etch}$ 应与热流成正比，说明其与生成气体的体积成正比。因此假设模型中的气体高度$l(t)$和生成气体也有类似的关系，于是：
$$
l(t)\cdot A=S_v\cdot h_{etch}\cdot \varepsilon_V\\
l(t)\cdot l_{hori}\cdot h_{etch}\varepsilon_A
=\bar {S_v} l_{hori} l_{tot}\cdot h_{etch}\cdot \varepsilon_V\\
\frac{l(t)}{l_{tot}}=\bar{l(t)}=\bar {S_v}\frac{\varepsilon_V}{\varepsilon_A}
$$
对于实验中使用的结构，系数分别为：

| # 200 | # 400 | # 600 | # 800 |
| ----- | ----- | ----- | ----- |
| 1.69  | 1.5   | 1.4   | 1.33  |









